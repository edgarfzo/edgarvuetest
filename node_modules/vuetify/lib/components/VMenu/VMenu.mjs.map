{"version":3,"file":"VMenu.mjs","names":["VDialogTransition","VDefaultsProvider","VOverlay","forwardRefs","useProxiedModel","useScopeId","computed","inject","mergeProps","provide","ref","watch","genericComponent","getUid","omit","useRender","filterVOverlayProps","makeVOverlayProps","VMenuSymbol","VMenu","name","props","id","String","closeDelay","closeOnContentClick","locationStrategy","openDelay","scrim","scrollStrategy","transition","component","emits","value","setup","slots","isActive","scopeId","uid","overlay","parent","openChildren","register","unregister","closeParents","setTimeout","val","onClickOutside","overlayProps","activatorProps","activator","default","args"],"sources":["../../../src/components/VMenu/VMenu.tsx"],"sourcesContent":["// Styles\nimport './VMenu.sass'\n\n// Components\nimport { VDialogTransition } from '@/components/transitions'\nimport { VDefaultsProvider } from '@/components/VDefaultsProvider'\nimport { VOverlay } from '@/components/VOverlay'\n\n// Composables\nimport { forwardRefs } from '@/composables/forwardRefs'\nimport { useProxiedModel } from '@/composables/proxiedModel'\nimport { useScopeId } from '@/composables/scopeId'\n\n// Utilities\nimport { computed, inject, mergeProps, provide, ref, watch } from 'vue'\nimport { genericComponent, getUid, omit, useRender } from '@/util'\nimport { filterVOverlayProps, makeVOverlayProps } from '@/components/VOverlay/VOverlay'\nimport { VMenuSymbol } from './shared'\n\n// Types\nimport type { SlotsToProps } from '@/util'\nimport type { OverlaySlots } from '@/components/VOverlay/VOverlay'\n\nexport const VMenu = genericComponent<new () => {\n  $props: SlotsToProps<OverlaySlots>\n}>()({\n  name: 'VMenu',\n\n  props: {\n    // TODO\n    // disableKeys: Boolean,\n    id: String,\n\n    ...omit(makeVOverlayProps({\n      closeDelay: 250,\n      closeOnContentClick: true,\n      locationStrategy: 'connected' as const,\n      openDelay: 300,\n      scrim: false,\n      scrollStrategy: 'reposition' as const,\n      transition: { component: VDialogTransition },\n    }), ['absolute']),\n  },\n\n  emits: {\n    'update:modelValue': (value: boolean) => true,\n  },\n\n  setup (props, { slots }) {\n    const isActive = useProxiedModel(props, 'modelValue')\n    const { scopeId } = useScopeId()\n\n    const uid = getUid()\n    const id = computed(() => props.id || `v-menu-${uid}`)\n\n    const overlay = ref<VOverlay>()\n\n    const parent = inject(VMenuSymbol, null)\n    let openChildren = 0\n    provide(VMenuSymbol, {\n      register () {\n        ++openChildren\n      },\n      unregister () {\n        --openChildren\n      },\n      closeParents () {\n        setTimeout(() => {\n          if (!openChildren) {\n            isActive.value = false\n            parent?.closeParents()\n          }\n        }, 40)\n      },\n    })\n\n    watch(isActive, val => {\n      val ? parent?.register() : parent?.unregister()\n    })\n\n    function onClickOutside () {\n      parent?.closeParents()\n    }\n\n    useRender(() => {\n      const [overlayProps] = filterVOverlayProps(props)\n\n      return (\n        <VOverlay\n          ref={ overlay }\n          class={[\n            'v-menu',\n          ]}\n          { ...overlayProps }\n          v-model={ isActive.value }\n          absolute\n          activatorProps={ mergeProps({\n            'aria-haspopup': 'menu',\n            'aria-expanded': String(isActive.value),\n            'aria-owns': id.value,\n          }, props.activatorProps) }\n          onClick:outside={ onClickOutside }\n          { ...scopeId }\n        >\n          {{\n            activator: slots.activator,\n            default: (...args) => (\n              <VDefaultsProvider root>\n                { slots.default?.(...args) }\n              </VDefaultsProvider>\n            ),\n          }}\n        </VOverlay>\n      )\n    })\n\n    return forwardRefs({ id }, overlay)\n  },\n})\n\nexport type VMenu = InstanceType<typeof VMenu>\n"],"mappings":"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"}